{"id":6413,"name":"prodRemedyTicketsToAutotaskBulk","userId":154529,"accountId":154251,"createdDate":"2018-09-07T23:05:10Z","steps":[{"id":63964,"onSuccess":["getTicketsFirstPage"],"onFailure":[],"name":"buildMetadata","type":"script","properties":{"body":"const moment = require('moment-timezone');\n\n//const formattedDate = moment().subtract(13, 'days').format('MM/DD/YY');\nconst formattedDate = moment().tz('America/New_York').subtract(5, 'minutes').format('MM/DD/YY hh:mm:ss a');\n\n\ndone({\n  \"query\":{\n     \"where\":\"'Assigned Group' = \\\"\" + config.assignedGroup + \"\\\"\" + \" AND 'Submit Date' >= \\\"09/01/18\\\" AND 'Last Modified Date' >= \" + \"\\\"\" + formattedDate + \"\\\"\"\n  }\n});"}},{"id":63974,"onSuccess":["isAutotaskTicketFirstPageExists"],"onFailure":[],"name":"getId","type":"script","properties":{"body":"const objectId = steps.getIncidentAutotaskFirstPage.response.body;\n\ndone({\n  \"objectId\": steps.getIncidentAutotaskFirstPage.response.body[0]\n});"}},{"id":63967,"onSuccess":["getIncidentAutotaskFirstPage"],"onFailure":[],"name":"buildMetadataAutotaskFirstPage","type":"script","properties":{"body":"const incidentNumber = steps.loopTicketFirstPage.entry.clientReferenceId;\n//const incidentNumber = 'INC000000762827';\n\ndone({\n  \"query\":{\n     \"where\":\"c$Client__Reference__ID =\" + \"'\" + incidentNumber + \"'\"\n  }\n});"}},{"id":63987,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"postIncidentAutotaskNextPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}","body":"${steps.loopTicketNextPage.entry}","method":"POST","elementInstanceId":"${config.destinationInstance}"}},{"id":63985,"onSuccess":["patchIncidentAutotaskNextPage"],"onFailure":["postIncidentAutotaskNextPage"],"name":"isAutotaskTicketNextPageExists","type":"filter","properties":{"body":"if(steps.getIdNextPage.objectId){\n  done(true)\n}"}},{"id":63986,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"patchIncidentAutotaskNextPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}/${steps.getIdNextPage.objectId.id}","retry":"true","body":"${steps.loopTicketNextPage.entry}","method":"PATCH","elementInstanceId":"${config.destinationInstance}"}},{"id":63984,"onSuccess":["isAutotaskTicketNextPageExists"],"onFailure":[],"name":"getIdNextPage","type":"script","properties":{"body":"done({\n  \"objectId\": steps.getIncidentAutotaskNextPage.response.body[0]\n});"}},{"id":63983,"onSuccess":["getIdNextPage"],"onFailure":[],"name":"getIncidentAutotaskNextPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}","query":"${steps.buildMetadataAutotaskNextPage.query}","method":"GET","elementInstanceId":"${config.destinationInstance}"}},{"id":63982,"onSuccess":["getIncidentAutotaskNextPage"],"onFailure":[],"name":"buildMetadataAutotaskNextPage","type":"script","properties":{"body":"const incidentNumber = steps.loopTicketNextPage.entry.clientReferenceId;\n//const incidentNumber = 'INC000000762827';\n\ndone({\n  \"query\":{\n     \"where\":\"clientReferenceId =\" + \"'\" + incidentNumber + \"'\"\n  }\n});"}},{"id":63981,"onSuccess":["buildMetadataAutotaskNextPage"],"onFailure":["setPageNumber"],"name":"loopTicketNextPage","type":"loop","properties":{"list":"${steps.getNextPage.response.body}"}},{"id":63980,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"isNextPageExists","type":"filter","properties":{"body":"done(steps.getNextPage.response.body.message !== 'Request failed')"}},{"id":63979,"onSuccess":["isNextPageExists"],"onFailure":[],"name":"getNextPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.source}","query":"${steps.setPageNumber.query}","acceptableStatusCodes":"502","method":"GET","elementInstanceId":"${config.sourceInstance}"}},{"id":63978,"onSuccess":["getNextPage"],"onFailure":[],"name":"setPageNumber","type":"script","properties":{"body":"if (steps.setPageNumber) {\n  done({ \n    \"query\":{\n      \"page\":steps.setPageNumber.query.page + 1,\n      \"where\":steps.buildMetadata.query.where\n    }\n  });\n}\n\ndone({ \n  \"query\":{\n    \"page\":2,\n    \"where\":steps.buildMetadata.query.where\n  }\n});"}},{"id":63977,"onSuccess":["setPageNumber"],"onFailure":[],"name":"setNextPageFirst","type":"script","properties":{"body":"done({ \n  \"query\":{\n    \"page\":2\n  }\n});"}},{"id":63966,"onSuccess":["buildMetadataAutotaskFirstPage"],"onFailure":["setNextPageFirst"],"name":"loopTicketFirstPage","type":"loop","properties":{"list":"${steps.getTicketsFirstPage.response.body}"}},{"id":63970,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"postIncidentAutotaskFirstPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}","body":"${steps.loopTicketFirstPage.entry}","method":"POST","elementInstanceId":"${config.destinationInstance}"}},{"id":63976,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"patchIncidentAutotaskFirstPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}/${steps.getId.objectId.id}","body":"${steps.loopTicketFirstPage.entry}","method":"PATCH","elementInstanceId":"${config.destinationInstance}"}},{"id":63969,"onSuccess":["patchIncidentAutotaskFirstPage"],"onFailure":["postIncidentAutotaskFirstPage"],"name":"isAutotaskTicketFirstPageExists","type":"filter","properties":{"body":"if(steps.getId.objectId){\n  done(true)\n}"}},{"id":63968,"onSuccess":["getId"],"onFailure":[],"name":"getIncidentAutotaskFirstPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}","query":"${steps.buildMetadataAutotaskFirstPage.query}","method":"GET","elementInstanceId":"${config.destinationInstance}"}},{"id":63973,"onSuccess":[],"onFailure":[],"name":"loopAutotaskTicketFirstPage","type":"loop","properties":{"list":"${steps.getIncidentAutotaskFirstPage.response.body}"}},{"id":63965,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"getTicketsFirstPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.source}","query":"${steps.buildMetadata.query}","method":"GET","elementInstanceId":"${config.sourceInstance}"}}],"triggers":[{"id":5795,"onSuccess":["buildMetadata"],"onFailure":[],"type":"manual","async":true,"name":"trigger","properties":{}}],"engine":"v3","active":true,"singleThreaded":false,"debugLoggingEnabled":true,"configuration":[{"id":17936,"key":"assignedGroup","name":"assignedGroup","type":"value","required":true},{"id":17941,"key":"destination","name":"destination","type":"value","required":true},{"id":17940,"key":"destinationInstance","name":"destinationInstance","type":"elementInstance","required":true},{"id":17939,"key":"source","name":"source","type":"value","required":true},{"id":17938,"key":"sourceInstance","name":"sourceInstance","type":"elementInstance","required":true}]}