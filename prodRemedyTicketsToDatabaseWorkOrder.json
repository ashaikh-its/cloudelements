{"id":6630,"name":"prodRemedyTicketsToDatabaseWorkOrder","userId":154529,"accountId":154251,"createdDate":"2018-10-04T15:41:46Z","steps":[{"id":65656,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"patchRecordNextPage","type":"elementRequest","properties":{"body":"${steps.loopTicketNextPage.entry}","retry":"true","api":"/hubs/db/${config.destination}/${steps.getIdNextPage.objectId.WorkOrderId}","method":"PATCH","elementInstanceId":"${config.destinationInstance}"}},{"id":65658,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"postRecordNextPage","type":"elementRequest","properties":{"body":"${steps.loopTicketNextPage.entry}","method":"POST","api":"/hubs/db/${config.destination}","elementInstanceId":"${config.destinationInstance}"}},{"id":65651,"onSuccess":["getRecordFirstPage"],"onFailure":[],"name":"buildRecordMetadataFirstPage","type":"script","properties":{"body":"const id = steps.loopTicketFirstPage.entry.WorkOrderId;\n\ndone({\n  \"query\":{\n     \"where\":\"WorkOrderId =\" + \"'\" + id + \"'\"\n  }\n});"}},{"id":65639,"onSuccess":["getTicketsFirstPage"],"onFailure":[],"name":"buildMetadata","type":"script","properties":{"body":"const moment = require('moment');\n\nconst formattedDate = moment().subtract(1, 'days').format('MM/DD/YY');\n//const formattedDate = moment().subtract(251, 'minutes').format('MM/DD/YY hh:mm:ss a');\n\ndone({\n  \"query\":{\n     //\"where\":\"Submit Date' >= \\\"01/01/2018\\\" AND Last Modified Date' >= \" + \"\\\"\" + formattedDate + \"\\\"\"\n     \"where\":\"'Submit Date' >= \\\"01/01/2018\\\" AND 'Last Modified Date' >= \\\"01/01/2018\\\"\"\n  }\n});"}},{"id":65652,"onSuccess":["buildRecordMetadataNextPage"],"onFailure":["setPageNumber"],"name":"loopTicketNextPage","type":"loop","properties":{"list":"${steps.getNextPage.response.body}"}},{"id":65657,"onSuccess":["patchRecordNextPage"],"onFailure":["postRecordNextPage"],"name":"isRecordNextPageExists","type":"filter","properties":{"body":"if(steps.getIdNextPage.objectId){\n  done(true)\n}"}},{"id":65655,"onSuccess":["isRecordNextPageExists"],"onFailure":[],"name":"getIdNextPage","type":"script","properties":{"body":"done({\n  \"objectId\": steps.getRecordNextPage.response.body[0]\n});"}},{"id":65654,"onSuccess":["getIdNextPage"],"onFailure":[],"name":"getRecordNextPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}","query":"${steps.buildRecordMetadataNextPage.query}","method":"GET","elementInstanceId":"${config.destinationInstance}"}},{"id":65653,"onSuccess":["getRecordNextPage"],"onFailure":[],"name":"buildRecordMetadataNextPage","type":"script","properties":{"body":"const id = steps.loopTicketNextPage.entry.WorkOrderId;\n//const incidentNumber = 'INC000000762827';\n\ndone({\n  \"query\":{\n     \"where\":\"WorkOrderId =\" + \"'\" + id + \"'\"\n  }\n});"}},{"id":65650,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"isNextPageExists","type":"filter","properties":{"body":"done(steps.getNextPage.response.body.message !== 'Request failed')"}},{"id":65649,"onSuccess":["isNextPageExists"],"onFailure":[],"name":"getNextPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.source}","query":"${steps.setPageNumber.query}","method":"GET","elementInstanceId":"${config.sourceInstance}","acceptableStatusCodes":"502"}},{"id":65648,"onSuccess":["getNextPage"],"onFailure":[],"name":"setPageNumber","type":"script","properties":{"body":"if (steps.setPageNumber) {\n  done({ \n    \"query\":{\n      \"page\":steps.setPageNumber.query.page + 1,\n      \"where\":steps.buildMetadata.query.where\n    }\n  });\n}\n\ndone({ \n  \"query\":{\n    \"page\":2,\n    \"where\":steps.buildMetadata.query.where\n  }\n});"}},{"id":65647,"onSuccess":["setPageNumber"],"onFailure":[],"name":"setNextPageFirst","type":"script","properties":{"body":"done({ \n  \"query\":{\n    \"page\":2\n  }\n});"}},{"id":65646,"onSuccess":["buildRecordMetadataFirstPage"],"onFailure":["setNextPageFirst"],"name":"loopTicketFirstPage","type":"loop","properties":{"list":"${steps.getTicketsFirstPage.response.body}"}},{"id":65644,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"patchRecordFirstPage","type":"elementRequest","properties":{"body":"${steps.loopTicketFirstPage.entry}","method":"PATCH","api":"/hubs/helpdesk/${config.destination}/${steps.getIdFirstPage.objectId.WorkOrderId}","elementInstanceId":"${config.destinationInstance}"}},{"id":65645,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"postRecordFirstPage","type":"elementRequest","properties":{"body":"${steps.loopTicketFirstPage.entry}","method":"POST","api":"/hubs/helpdesk/${config.destination}","elementInstanceId":"${config.destinationInstance}"}},{"id":65643,"onSuccess":["patchRecordFirstPage"],"onFailure":["postRecordFirstPage"],"name":"isRecordFirstPageExists","type":"filter","properties":{"body":"if(steps.getIdFirstPage.objectId){\n  done(true)\n}"}},{"id":65642,"onSuccess":["isRecordFirstPageExists"],"onFailure":[],"name":"getIdFirstPage","type":"script","properties":{"body":"done({\n    \"objectId\": steps.getRecordFirstPage.response.body[0]\n  })"}},{"id":65641,"onSuccess":["getIdFirstPage"],"onFailure":[],"name":"getRecordFirstPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}","method":"GET","query":"${steps.buildRecordMetadataFirstPage.query}","elementInstanceId":"${config.destinationInstance}"}},{"id":65638,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"isPageExists","type":"filter","properties":{"body":"done(steps.getTicketsFirstPage.response.body.message !== 'Request failed')"}},{"id":65637,"onSuccess":["isPageExists"],"onFailure":[],"name":"getTicketsFirstPage","type":"elementRequest","properties":{"query":"${steps.buildMetadata.query}","api":"/hubs/helpdesk/${config.source}","method":"GET","elementInstanceId":"${config.sourceInstance}","acceptableStatusCodes":"502"}},{"id":65640,"onSuccess":[],"onFailure":[],"name":"loopAutotaskTicketFirstPage","type":"loop","properties":{"list":"${steps.getRecordFirstPage.response.body}"}}],"triggers":[{"id":5965,"onSuccess":["buildMetadata"],"onFailure":[],"type":"scheduled","async":true,"name":"trigger","properties":{"cron":""}}],"engine":"v3","active":true,"debugLoggingEnabled":true,"singleThreaded":false,"configuration":[{"id":18271,"key":"destination","name":"destination","type":"value","required":true},{"id":18272,"key":"destinationInstance","name":"destinationInstance","type":"elementInstance","required":true},{"id":18273,"key":"source","name":"source","type":"value","required":true},{"id":18274,"key":"sourceInstance","name":"sourceInstance","type":"elementInstance","required":true}]}