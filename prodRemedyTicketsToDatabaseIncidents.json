{"id":6647,"name":"prodRemedyTicketsToDatabaseIncidents","userId":154529,"accountId":154251,"createdDate":"2018-10-11T17:29:31Z","steps":[{"id":65767,"onSuccess":["buildRecordMetadataNextPage"],"onFailure":["setPageNumber"],"name":"loopTicketNextPage","type":"loop","properties":{"list":"${steps.getNextPage.response.body}"}},{"id":65763,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"patchRecordNextPage","type":"elementRequest","properties":{"api":"/hubs/db/${config.destination}/${steps.getIdNextPage.objectId.IncidentNumber}","method":"PATCH","body":"${steps.loopTicketNextPage.entry}","retry":"true","elementInstanceId":"${config.destinationInstance}"}},{"id":65764,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"postRecordNextPage","type":"elementRequest","properties":{"api":"/hubs/db/${config.destination}","method":"POST","body":"${steps.loopTicketNextPage.entry}","elementInstanceId":"${config.destinationInstance}"}},{"id":65765,"onSuccess":["getRecordFirstPage"],"onFailure":[],"name":"buildRecordMetadataFirstPage","type":"script","properties":{"body":"const id = steps.loopTicketFirstPage.entry.IncidentNumber;\n\ndone({\n  \"query\":{\n     \"where\":\"IncidentNumber =\" + \"'\" + id + \"'\"\n  }\n});"}},{"id":65768,"onSuccess":["patchRecordNextPage"],"onFailure":["postRecordNextPage"],"name":"isRecordNextPageExists","type":"filter","properties":{"body":"if(steps.getIdNextPage.objectId){\n  done(true)\n}"}},{"id":65769,"onSuccess":["isRecordNextPageExists"],"onFailure":[],"name":"getIdNextPage","type":"script","properties":{"body":"done({\n  \"objectId\": steps.getRecordNextPage.response.body[0]\n});"}},{"id":65770,"onSuccess":["getIdNextPage"],"onFailure":[],"name":"getRecordNextPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}","method":"GET","query":"${steps.buildRecordMetadataNextPage.query}","elementInstanceId":"${config.destinationInstance}"}},{"id":65771,"onSuccess":["getRecordNextPage"],"onFailure":[],"name":"buildRecordMetadataNextPage","type":"script","properties":{"body":"const id = steps.loopTicketNextPage.entry.IncidentNumber;\n//const incidentNumber = 'INC000000762827';\n\ndone({\n  \"query\":{\n     \"where\":\"IncidentNumber =\" + \"'\" + id + \"'\"\n  }\n});"}},{"id":65772,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"isNextPageExists","type":"filter","properties":{"body":"done(steps.getNextPage.response.body.message !== 'Request failed')"}},{"id":65773,"onSuccess":["isNextPageExists"],"onFailure":[],"name":"getNextPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.source}","method":"GET","query":"${steps.setPageNumber.query}","acceptableStatusCodes":"502","elementInstanceId":"${config.sourceInstance}"}},{"id":65774,"onSuccess":["getNextPage"],"onFailure":[],"name":"setPageNumber","type":"script","properties":{"body":"if (steps.setPageNumber) {\n  done({ \n    \"query\":{\n      \"page\":steps.setPageNumber.query.page + 1,\n      \"where\":steps.buildMetadata.query.where\n    }\n  });\n}\n\ndone({ \n  \"query\":{\n    \"page\":2,\n    \"where\":steps.buildMetadata.query.where\n  }\n});"}},{"id":65775,"onSuccess":["setPageNumber"],"onFailure":[],"name":"setNextPageFirst","type":"script","properties":{"body":"done({ \n  \"query\":{\n    \"page\":2\n  }\n});"}},{"id":65776,"onSuccess":["buildRecordMetadataFirstPage"],"onFailure":["setNextPageFirst"],"name":"loopTicketFirstPage","type":"loop","properties":{"list":"${steps.getTicketsFirstPage.response.body}"}},{"id":65778,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"postRecordFirstPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}","method":"POST","body":"${steps.loopTicketFirstPage.entry}","elementInstanceId":"${config.destinationInstance}"}},{"id":65777,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"patchRecordFirstPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}/${steps.getIdFirstPage.objectId.IncidentNumber}","method":"PATCH","body":"${steps.loopTicketFirstPage.entry}","elementInstanceId":"${config.destinationInstance}"}},{"id":65779,"onSuccess":["patchRecordFirstPage"],"onFailure":["postRecordFirstPage"],"name":"isRecordFirstPageExists","type":"filter","properties":{"body":"if(steps.getIdFirstPage.objectId){\n  done(true)\n}"}},{"id":65780,"onSuccess":["isRecordFirstPageExists"],"onFailure":[],"name":"getIdFirstPage","type":"script","properties":{"body":"done({\n    \"objectId\": steps.getRecordFirstPage.response.body[0]\n  })"}},{"id":65781,"onSuccess":["getIdFirstPage"],"onFailure":[],"name":"getRecordFirstPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.destination}","method":"GET","query":"${steps.buildRecordMetadataFirstPage.query}","elementInstanceId":"${config.destinationInstance}"}},{"id":65782,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"isPageExists","type":"filter","properties":{"body":"done(steps.getTicketsFirstPage.response.body.message !== 'Request failed')"}},{"id":65784,"onSuccess":[],"onFailure":[],"name":"loopAutotaskTicketFirstPage","type":"loop","properties":{"list":"${steps.getRecordFirstPage.response.body}"}},{"id":65783,"onSuccess":["isPageExists"],"onFailure":[],"name":"getTicketsFirstPage","type":"elementRequest","properties":{"api":"/hubs/helpdesk/${config.source}","method":"GET","query":"${steps.buildMetadata.query}","acceptableStatusCodes":"502","elementInstanceId":"${config.sourceInstance}"}},{"id":65766,"onSuccess":["getTicketsFirstPage"],"onFailure":[],"name":"buildMetadata","type":"script","properties":{"body":"const moment = require('moment');\n\nconst formattedDate = moment().subtract(1, 'days').format('MM/DD/YY');\n//const formattedDate = moment().subtract(251, 'minutes').format('MM/DD/YY hh:mm:ss a');\n\ndone({\n  \"query\":{\n     //\"where\":\"Submit Date' >= \\\"01/01/2018\\\" AND Last Modified Date' >= \" + \"\\\"\" + formattedDate + \"\\\"\"\n     \"where\":\"'Submit Date' >= \\\"01/01/2018\\\" AND 'Last Modified Date' >= \\\"01/01/2018\\\"\"\n  }\n});"}}],"triggers":[{"id":5980,"onSuccess":["buildMetadata"],"onFailure":[],"type":"scheduled","async":true,"name":"trigger","properties":{"cron":""}}],"engine":"v3","active":true,"singleThreaded":false,"debugLoggingEnabled":true,"configuration":[{"id":18307,"key":"destination","name":"destination","type":"value","required":true},{"id":18308,"key":"destinationInstance","name":"destinationInstance","type":"elementInstance","required":true},{"id":18309,"key":"source","name":"source","type":"value","required":true},{"id":18310,"key":"sourceInstance","name":"sourceInstance","type":"elementInstance","required":true}]}