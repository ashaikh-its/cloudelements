{"id":6425,"name":"prodRemedyTicketsToAutotaskScheduled","userId":154529,"accountId":154251,"createdDate":"2018-09-10T15:20:47Z","steps":[{"id":64100,"onSuccess":["getIncidentAutotaskFirstPage"],"onFailure":[],"name":"buildMetadataAutotaskFirstPage","type":"script","properties":{"body":"const incidentNumber = steps.loopTicketFirstPage.entry.clientReferenceId;\n//const incidentNumber = 'INC000000762827';\n\ndone({\n  \"query\":{\n     \"where\":\"c$Client__Reference__ID =\" + \"'\" + incidentNumber + \"'\"\n  }\n});"}},{"id":64113,"onSuccess":["getTicketsFirstPage"],"onFailure":[],"name":"buildMetadata","type":"script","properties":{"body":"const moment = require('moment-timezone');\n\nconst formattedDate = moment().tz('America/New_York').subtract(11, 'minutes').format('MM/DD/YY hh:mm:ss a');\n//const formattedDate = moment().tz('America/New_York').subtract(11, 'days').format('MM/DD/YY');\n\ndone({\n  \"query\":{\n     \"where\":\"'Assigned Group' = \\\"\" + config.assignedGroup + \"\\\"\" + \" AND 'Submit Date' >= \\\"09/01/18\\\" AND 'Last Modified Date' >= \" + \"\\\"\" + formattedDate + \"\\\"\"\n  }\n});"}},{"id":64112,"onSuccess":["isPageExists"],"onFailure":[],"name":"getTicketsFirstPage","type":"elementRequest","properties":{"query":"${steps.buildMetadata.query}","method":"GET","api":"/hubs/helpdesk/${config.source}","elementInstanceId":"${config.sourceInstance}","acceptableStatusCodes":"502"}},{"id":64120,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"isPageExists","type":"filter","properties":{"body":"done(steps.getTicketsFirstPage.response.body.message !== 'Request failed')"}},{"id":64111,"onSuccess":[],"onFailure":[],"name":"loopAutotaskTicketFirstPage","type":"loop","properties":{"list":"${steps.getIncidentAutotaskFirstPage.response.body}"}},{"id":64110,"onSuccess":["getId"],"onFailure":[],"name":"getIncidentAutotaskFirstPage","type":"elementRequest","properties":{"method":"GET","api":"/hubs/helpdesk/${config.destination}","query":"${steps.buildMetadataAutotaskFirstPage.query}","elementInstanceId":"${config.destinationInstance}"}},{"id":64109,"onSuccess":["isAutotaskTicketFirstPageExists"],"onFailure":[],"name":"getId","type":"script","properties":{"body":"const objectId = steps.getIncidentAutotaskFirstPage.response.body;\n\ndone({\n  \"objectId\": steps.getIncidentAutotaskFirstPage.response.body[0]\n});"}},{"id":64108,"onSuccess":["patchIncidentAutotaskFirstPage"],"onFailure":["postIncidentAutotaskFirstPage"],"name":"isAutotaskTicketFirstPageExists","type":"filter","properties":{"body":"if(steps.getId.objectId){\n  done(true)\n}"}},{"id":64107,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"patchIncidentAutotaskFirstPage","type":"elementRequest","properties":{"body":"${steps.loopTicketFirstPage.entry}","method":"PATCH","api":"/hubs/helpdesk/${config.destination}/${steps.getId.objectId.id}","elementInstanceId":"${config.destinationInstance}"}},{"id":64106,"onSuccess":["loopTicketFirstPage"],"onFailure":[],"name":"postIncidentAutotaskFirstPage","type":"elementRequest","properties":{"body":"${steps.loopTicketFirstPage.entry}","method":"POST","api":"/hubs/helpdesk/${config.destination}","elementInstanceId":"${config.destinationInstance}"}},{"id":64105,"onSuccess":["buildMetadataAutotaskFirstPage"],"onFailure":["setNextPageFirst"],"name":"loopTicketFirstPage","type":"loop","properties":{"list":"${steps.getTicketsFirstPage.response.body}"}},{"id":64104,"onSuccess":["setPageNumber"],"onFailure":[],"name":"setNextPageFirst","type":"script","properties":{"body":"done({ \n  \"query\":{\n    \"page\":2\n  }\n});"}},{"id":64103,"onSuccess":["getNextPage"],"onFailure":[],"name":"setPageNumber","type":"script","properties":{"body":"if (steps.setPageNumber) {\n  done({ \n    \"query\":{\n      \"page\":steps.setPageNumber.query.page + 1,\n      \"where\":steps.buildMetadata.query.where\n    }\n  });\n}\n\ndone({ \n  \"query\":{\n    \"page\":2,\n    \"where\":steps.buildMetadata.query.where\n  }\n});"}},{"id":64102,"onSuccess":["isNextPageExists"],"onFailure":[],"name":"getNextPage","type":"elementRequest","properties":{"method":"GET","api":"/hubs/helpdesk/${config.source}","query":"${steps.setPageNumber.query}","elementInstanceId":"${config.sourceInstance}","acceptableStatusCodes":"502"}},{"id":64101,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"isNextPageExists","type":"filter","properties":{"body":"done(steps.getNextPage.response.body.message !== 'Request failed')"}},{"id":64099,"onSuccess":["buildMetadataAutotaskNextPage"],"onFailure":["setPageNumber"],"name":"loopTicketNextPage","type":"loop","properties":{"list":"${steps.getNextPage.response.body}"}},{"id":64098,"onSuccess":["getIncidentAutotaskNextPage"],"onFailure":[],"name":"buildMetadataAutotaskNextPage","type":"script","properties":{"body":"const incidentNumber = steps.loopTicketNextPage.entry.clientReferenceId;\n//const incidentNumber = 'INC000000762827';\n\ndone({\n  \"query\":{\n     \"where\":\"c$Client__Reference__ID =\" + \"'\" + incidentNumber + \"'\"\n  }\n});"}},{"id":64097,"onSuccess":["getIdNextPage"],"onFailure":[],"name":"getIncidentAutotaskNextPage","type":"elementRequest","properties":{"method":"GET","api":"/hubs/helpdesk/${config.destination}","query":"${steps.buildMetadataAutotaskNextPage.query}","elementInstanceId":"${config.destinationInstance}"}},{"id":64096,"onSuccess":["isAutotaskTicketNextPageExists"],"onFailure":[],"name":"getIdNextPage","type":"script","properties":{"body":"done({\n  \"objectId\": steps.getIncidentAutotaskNextPage.response.body[0]\n});"}},{"id":64095,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"patchIncidentAutotaskNextPage","type":"elementRequest","properties":{"body":"${steps.loopTicketNextPage.entry}","retry":"true","method":"PATCH","api":"/hubs/helpdesk/${config.destination}/${steps.getIdNextPage.objectId.id}","elementInstanceId":"${config.destinationInstance}"}},{"id":64094,"onSuccess":["patchIncidentAutotaskNextPage"],"onFailure":["postIncidentAutotaskNextPage"],"name":"isAutotaskTicketNextPageExists","type":"filter","properties":{"body":"if(steps.getIdNextPage.objectId){\n  done(true)\n}"}},{"id":64093,"onSuccess":["loopTicketNextPage"],"onFailure":[],"name":"postIncidentAutotaskNextPage","type":"elementRequest","properties":{"body":"${steps.loopTicketNextPage.entry}","method":"POST","api":"/hubs/helpdesk/${config.destination}","elementInstanceId":"${config.destinationInstance}"}}],"triggers":[{"id":5806,"onSuccess":["buildMetadata"],"onFailure":[],"type":"scheduled","async":true,"name":"trigger","properties":{"cron":"0 0/10 * 1/1 * ? *"}}],"engine":"v3","active":true,"debugLoggingEnabled":true,"singleThreaded":false,"configuration":[{"id":17960,"key":"assignedGroup","name":"assignedGroup","type":"value","required":true},{"id":17961,"key":"destination","name":"destination","type":"value","required":true},{"id":17962,"key":"destinationInstance","name":"destinationInstance","type":"elementInstance","required":true},{"id":17963,"key":"source","name":"source","type":"value","required":true},{"id":17964,"key":"sourceInstance","name":"sourceInstance","type":"elementInstance","required":true}]}